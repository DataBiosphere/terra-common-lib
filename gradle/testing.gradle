test {
    useJUnitPlatform()
    finalizedBy jacocoTestReport
    // N.B. we can't run test suites in parallel, as two different logging test
    // suites (LoggingTest and HumanReadableLoggingTest) both depend on sole
    // ownership of the console output. This might be fixed by redirecting
    // output to uniquely-named files and reading from there.
    maxParallelForks = 1
}

tasks.withType(Test) {
    testLogging {
        events = [
                'passed',
                'failed',
                'skipped'
        ]
        // Causes the correct line to be reported on an exception.
        exceptionFormat = org.gradle.api.tasks.testing.logging.TestExceptionFormat.FULL
        reports {
            // Write XML file (used by CircleCI, Jenkins, etc) to build/test-results/*
            junitXml.required true
            // Write human-readable test report to build/reports/tests/*
            html.required true
        }
    }
}
